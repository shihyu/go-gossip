<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>位元組構成的字串</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div id="main" role="main" style="height: auto !important;">
<div class="header">
<h1 id="位元組構成的字串"><a class="header" href="#位元組構成的字串">位元組構成的字串</a></h1>
</div>
<p>在〈<a href="http://openhome.cc/Gossip/Go/PreDeclaredType.html">認識預定義型態</a>〉中略略談過字串，表面看來，用雙引號（<code>"</code>）或反引號（`）括起來的文字就是字串，預設型態為 <code>string</code>，實際在 Go 中，字串是由唯讀的 UTF-8 編碼位元組所組成。</p>
<h1 id="字串入門"><a class="header" href="#字串入門">字串入門</a></h1>
<p>先從簡單的開始，在 Go 原始碼中，如果你撰寫 <code>"Go語言"</code> 這麼一段文字，那麼會產生一個字串，預設型態為 <code>string</code>，字串是唯讀的，一旦建立，就無法改變字串內容。</p>
<p>使用 <code>string</code> 宣告變數若無指定初值，預設是空字串 <code>""</code>，可以使用 <code>+</code> 對兩個字串進行串接，由於字串是唯讀的，因此實際上串接的動作，會產生新的字串，如果想比較兩個字串的相等性，可以使用 <code>==</code>、<code>!=</code>、<code>&lt;</code>、<code>&lt;=</code>、<code>&gt;</code>、<code>&gt;=</code> 依字典順序比較。</p>
<pre><code class="language-prettyprint">package main

import "fmt"

func main() {
    text1 := "Go語言"
    text2 := "Cool"
    var text3 string
    fmt.Println(text1 + text2) // Go語言Cool
    fmt.Printf("%q\n", text3)  // ""
    fmt.Println(text1 &gt; text2) // true
}
</code></pre>
<p>上面的例子中，由於使用 <code>fmt.Println</code> 顯示空字串時看不到什麼，因此改用 <code>fmt.Printf</code>，並使用 <code>%q</code> 來脫離無法顯示的字元。</p>
<div class="google-auto-placed" style="width: 100%; height: auto; clear: both; text-align: center;">
</div>
<p>使用 <code>""</code> 時不可換行，如果你的字串想要換行，方法之一是分兩個字串，並用 <code>+</code> 串接。例如：</p>
<pre><code class="language-prettyprint">    text := "Go語言" +
            "Cool" 
</code></pre>
<p>另一個方式是以重音符 ` 定義字串，例如：</p>
<pre><code class="language-prettyprint">package main

import "fmt"

func main() {
    text := `Go語言
                 Cool`
    fmt.Printf("%q\n", text) // "Go語言\n                  Cool"
}
</code></pre>
<p>使用 ` 定義的字串，會完全保留換行與空白，因此，在上頭你可以看到被保留的換行與空白字元，如果使用 <code>fmt.Println(text)</code>，顯示時也會看到對應的換行與空白。使用 ` 定義的字串，也不會轉譯字元，例如：</p>
<pre><code class="language-prettyprint">package main

import "fmt"

func main() {
    text := `Go語言\nCool`
    fmt.Println(text)  // Go語言\nCool
}
</code></pre>
<div class="google-auto-placed" style="width: 100%; height: auto; clear: both; text-align: center;">
</div>
<p>在這個例子中可以看到，使用 ` 時，不會對 <code>\n</code> 做轉譯的動作，因此，你會直接看到顯示了「Go語言\nCool」。</p>
<p>在 Go 中可以使用的轉譯有：</p>
<ul>
<li><code>\a</code>：U+0007，警示或響鈴</li>
<li><code>\b</code>：U+0008，倒退（backspace）</li>
<li><code>\f</code>：U+000C，饋頁（form feed）</li>
<li><code>\n</code>：U+000A，換行（newline）</li>
<li><code>\r</code>：U+000D，歸位（carriage return）</li>
<li><code>\t</code>：U+0009，水平 tab</li>
<li><code>\v</code>：U+000b，垂直 tab</li>
<li><code>\\</code>：U+005c，反斜線（backslash）</li>
<li><code>\"</code>：U+0022，雙引號</li>
<li><code>\ooo</code>：位元組表示，o 為八進位數字</li>
<li><code>\xhh</code>：位元組表示，h 為十六進位數字</li>
<li><code>\uhhhh</code>：Unicode 點點表示，使用四個 16 進位數字</li>
<li><code>\Uhhhhhhhh</code>：Unicode 點點表示，使用八個 16 進位數字</li>
</ul>
<h1 id="唯讀位元組片段"><a class="header" href="#唯讀位元組片段">唯讀位元組片段</a></h1>
<p>那麼，想知道一個字串的長度該怎麼做呢？Go 中有個 <code>len</code> 函式，當它作用於字串時，結果可能會令一些從其他程式語言，像是 Java 過來的人感到訝異：</p>
<pre><code class="language-prettyprint">package main

import "fmt"

func main() {
    fmt.Println(len("Go語言")) // 8
}
</code></pre>
<div class="google-auto-placed" style="width: 100%; height: auto; clear: both; text-align: center;">
</div>
<p>顯示的結果是 8 而不是 4，給個提示，Go 的字串實作使用 UTF-8，是的！<code>len</code> 傳回的是位元組長度，因為 Go 的字串，本質上是 UTF-8 編碼後的位元組組成，如果你使用 <code>fmt.Printf("%x", "Go語言")</code>，會顯示 476fe8aa9ee8a880，47 是「G」的位元組以 16 進位數字表示的結果，6f 是 o，e8aa9e 是「語」的三個位元組分別以 16 進位數字表示的結果，e8a880 是「言」。</p>
<p>不單是如此，Go 中可以使用 <code>[]</code> 與索引來取得字串的位元組資料，是的，位元組！傳回的型態是 <code>byte</code>（<code>uint8</code>），<code>"Go語言"[0]</code> 取得的是 G 的位元組資料，<code>"Go語言"[1]</code> 取得的是 o 的位元組資料，<code>"Go語言"[2]</code> 呢？取得的是「語」的 UTF-8 實作中，第一個位元組資料，也就是 e8。可以用以下這個程式片段來印證：</p>
<pre><code class="language-prettyprint">package main

import "fmt"

func main() {
    text := "Go語言"
    for i := 0; i &lt; len(text); i++ {
        fmt.Printf("%x ", text[i])
    }
}
</code></pre>
<div class="google-auto-placed" style="width: 100%; height: auto; clear: both; text-align: center;">
</div>
<p>雖然還沒正確介紹 <code>for</code> 迴圈，不過程式應該很清楚，用迴圈遞增的 <code>i</code> 值來取得指定索引處的資料，結果是顯示「47 6f e8 aa 9e e8 a8 80 」。</p>
<p>這個位元組序列是怎麼決定的？當你寫下 <code>"Go語言"</code>，你的 .go 原始碼檔案是什麼編碼呢？是的！UTF-8，Go 就是從這當中取得 <code>"Go語言"</code> 位元組序列，每個位元組就是 UTF-8 的一個碼元（code unit）。</p>
<p>雖說字串是唯讀的位元組片段，不過，實際的位元組是隱藏在字串底層，如果你想取得，必須轉為 <code>[]byte</code>，例如：</p>
<pre><code class="language-prettyprint">package main

import "fmt"

func main() {
    text1 := "Go語言"
    bs := []byte(text1)
    bs[0] = 103
    text2 := string(bs)
    fmt.Println(text1) // Go語言
    fmt.Println(text2) // go語言
}
</code></pre>
<p>注意，你不是真的取得字串底層的位元組資料，只是取得複本，因此，在範例中可以看到，雖然對 <code>text2</code> 的位元組做了修改，<code>text1</code> 是不受影響的，記得，字串是唯讀的，一旦建立，沒有方式可以改變其內容。</p>
<h1 id="string-與索引"><a class="header" href="#string-與索引">string 與索引</a></h1>
<p>實際上，Go 的字串支援片段操作，slice 操作時的索引是針對位元組，然而，傳回的型態還是 <code>string</code>，例如，<code>"Go語言"[0:2]</code>，傳回 <code>"Go"</code>，因為指定要切割出索引 0 開始，索引 2 結束（但不包括 2）的部份，也就是 47 與 6f 這兩個位元組，但是以 <code>string</code> 傳回。</p>
<p>那麼，如果是 <code>"Go語言"[2:3]</code> 呢？嗯，傳回的字串是 <code>"\xe8"</code>！這是什麼？事實上，Go 中的字串可以是任意位元組片段，因此，你可以如下定義字串：</p>
<pre><code class="language-prettyprint">package main

import "fmt"

func main() {
    text := "\x47\x6f\xe8\xaa\x9e\xe8\xa8\x80"
    fmt.Println(text)  // Go語言
}
</code></pre>
<p>片段操作時，如果省略冒號之後的數字，則預設取得至字串尾端的子字串，例如 <code>"Go語言"[3:]</code> 會傳回 <code>"\xaa\x9e\xe8\xa8\x80"</code> 的字串，如果省略冒號之前的數字，預設從索引 0 開始，例如 <code>"Go語言"[:2]</code> 會取得 <code>"Go"</code> 的字串，也就是 <code>"\x47\x6f"</code> 的字串，如果是 <code>"Go語言"[:]</code>，那麼就是取得全部字串內容了。</p>
<p><a href="https://pkg.go.dev/strings/"><code>strings</code> 套件</a> 中有不少字串可用的方法，想做字串操作時，可以多加利用，不過要看清楚是針對什麼在操作。例如 <code>strings.Index</code>：</p>
<pre><code class="language-prettyprint">package main

import "fmt"
import "strings"

func main() {
    text := "Go語言"
    fmt.Printf("%d\n", strings.Index(text, "言"))  // 5
}
</code></pre>
<p>傳回的索引值是 5 而不是 3，這是因為 <code>"言"</code> 的第一個位元組，是在 <code>"Go語言"</code> UTF-8 編碼後的位元組組成中第 5 個索引位置。</p>
<p>問題來了，如果對於 <code>"Go語言"</code>，想逐一取得 <code>'G'</code>、<code>'o'</code>、<code>'語'</code>、<code>'言'</code> 該怎麼辦？當然不能用 <code>text[n]</code>，這只會取得第 n 個位元組，可以將字串型態轉換為 <code>[]rune</code> ：</p>
<pre><code class="language-prettyprint">package main

import "fmt"

func main() {
    text := "Go語言"
    cs := []rune(text)
    fmt.Printf("%c\n", cs[2]) // 語
    fmt.Println(len(cs))      // 4
}
</code></pre>
<p>字串型態轉換為 <code>[]rune</code> 時，會將 UTF-8 編碼的位元組，轉換為 Unicode 碼點，在這個例子中可以看到，<code>cs[2]</code> 確實地取得了第三個文字「語」，而 <code>len</code> 也確實取得數量 4。</p>
<p>如〈<a href="http://openhome.cc/Gossip/Go/PreDeclaredType.html">認識預定義型態</a>〉中談過的，在 Go 中並沒有字元對應的型態，只有碼點的概念，<code>rune</code> 為 <code>int32</code> 的別名，可用來儲存 Unicode 碼點（code point），如果使用 <code>fmt.Printf("%d\n", cs[2])</code>，會顯示 35486，這就是「語」的 Unicode 碼點，35486 的 16 進位表示是 8a9e，因此，如果你寫 <code>'\u8a9e'</code>，也會得到一個 <code>rune</code> 代表著「語」，<code>fmt.Printf("%c", '\u8a9e')</code> 也會顯示「語」，當然，直接寫 <code>'語'</code> 也是可以得到一個 <code>rune</code>。</p>
<p>想從 <code>rune</code> 得到一個 <code>string</code>，可以直接寫 <code>string('語')</code> 就可以了。如果想以 <code>rune</code> 為單位來走訪字串，而不是以位元組走訪，可以使用 <code>for range</code>，例如：</p>
<pre><code class="language-prettyprint">package main

import "fmt"

func main() {
    text := "Go語言"
    for index, runeValue := range text {
        fmt.Printf("%#U 位元起始位置 %d\n", runeValue, index)
    }
}
</code></pre>
<p>可以看到，<code>for range</code> 可以同時取得每個 <code>rune</code> 在字串中的位元起始位置，以及 <code>rune</code> 值，<code>%U</code> 可以用 16 進位顯示 <code>rune</code>，如果是 <code>%#U</code>，還會一併顯示碼點的列印形式。</p>
<p>這個程式的執行結果會顯示：</p>
<pre><code class="language-prettyprint">U+0047 'G' 位元起始位置 0
U+006F 'o' 位元起始位置 1
U+8A9E '語' 位元起始位置 2
U+8A00 '言' 位元起始位置 5
</code></pre>
<p>總而言之，Go 的字串是由 UTF-8 編碼的位元組構成，在〈<a href="https://go.dev/blog/strings">Strings, bytes, runes and characters in Go</a>〉談到了這麼設計的理由是，「字元」的定義太模稜兩可了，Go 為了避免模稜兩可，就將字串定義為 UTF-8 編碼的位元組構成，而 <code>rune</code> 用於儲存碼點。</p>
<p>PS. 這大概也是為何，我會整理出〈<a href="http://openhome.cc/Gossip/Encoding/">亂碼 1/2</a>〉的原因 … XD</p>
<div class="ad336-280" style="text-align: center;">
</div>
<div class="recommend" style="text-align: center;">
<hr />
</div>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="VariableConstantDeclaration.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="Array.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="VariableConstantDeclaration.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="Array.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
